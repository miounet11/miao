# Linear Method: Quota ç³»ç»Ÿè®¾è®¡

## Problem Statement

### What is the problem?
ç¨‹åºå‘˜éœ€è¦æ¸…æ¥šçŸ¥é“å‰©ä½™é¢åº¦ï¼Œä½†ä¸æƒ³è¢«å¤æ‚çš„è®¡è´¹ç³»ç»Ÿå›°æ‰°ã€‚

### Who is affected?
- âœ… æ‰€æœ‰ç”¨æˆ·ï¼ˆæ¯å¤©éƒ½çœ‹åˆ°çŠ¶æ€æ ï¼‰
- âœ… å…è´¹ç”¨æˆ·ï¼ˆéœ€è¦çŸ¥é“ä½•æ—¶ç”¨å®Œï¼‰
- âœ… API Key ç”¨æˆ·ï¼ˆéœ€è¦çŸ¥é“ä¸æ¶ˆè€—é¢åº¦ï¼‰

### Impact?
- âœ… Major - ç›´æ¥å½±å“ç”¨æˆ·ä¿¡ä»»
- å¦‚æœä¸å¤Ÿç›´è§‚ â†’ ç”¨æˆ·æ‹…å¿ƒçªç„¶ç”¨å®Œ
- å¦‚æœå¤ªå¤æ‚ â†’ ç”¨æˆ·ä¸çŸ¥é“å¦‚ä½•è·å–æ›´å¤š

### RICE Score
```
Reach: 10 (æ‰€æœ‰ç”¨æˆ·)
Impact: 3.0 (Massive - å½±å“ä¿¡ä»»)
Confidence: 100%
Effort: 0.5 äººæœˆ

RICE = (10 Ã— 3.0 Ã— 1.0) / 0.5 = 60.0  â† æé«˜ä¼˜å…ˆçº§
```

---

## Solution - æç®€è®¾è®¡

### æ ¸å¿ƒåŸåˆ™

1. **ä¸€çœ¼çœ‹æ‡‚** - ä¸éœ€è¦å­¦ä¹ 
2. **é›¶é…ç½®** - å¼€ç®±å³ç”¨
3. **æ˜ç¡®åé¦ˆ** - æ¸…æ¥šçŸ¥é“ä¸‹ä¸€æ­¥
4. **ä¸æ‰“æ‰°** - åªåœ¨å¿…è¦æ—¶æé†’

### çŠ¶æ€æ è®¾è®¡

```
æ­£å¸¸:  âš¡ 45/50  (ç™½è‰²)
è­¦å‘Š:  âš ï¸ 8/50   (æ©™è‰²)
å±é™©:  ğŸ”´ 2/50   (çº¢è‰²)
æ— é™:  âˆ API Key (ç»¿è‰²)
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
- âœ… å›¾æ ‡æœ‰æ˜ç¡®è¯­ä¹‰ï¼ˆâš¡=æ­£å¸¸ï¼Œâš ï¸=æ³¨æ„ï¼ŒğŸ”´=å±é™©ï¼‰
- âœ… æ•°å­—ç›´è§‚ï¼ˆ45/50 ä¸€çœ¼çœ‹æ‡‚ï¼‰
- âœ… é¢œè‰²æœ‰å¿ƒç†æš—ç¤ºï¼ˆç»¿=å®‰å…¨ï¼Œæ©™=è­¦å‘Šï¼Œçº¢=å±é™©ï¼‰
- âœ… æ— é™ç¬¦å· âˆ è®© API Key ç”¨æˆ·å®‰å¿ƒ

### è¯¦æƒ…é¢æ¿è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»Šæ—¥é¢åº¦                     â”‚
â”‚                             â”‚
â”‚        45                   â”‚  â† å¤§å­—ï¼Œä¸€çœ¼çœ‹åˆ°
â”‚       / 50                  â”‚
â”‚                             â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 90%    â”‚  â† è¿›åº¦æ¡ï¼Œç›´è§‚
â”‚                             â”‚
â”‚ â€¢ å·²ä½¿ç”¨ 5 æ¬¡                â”‚  â† ç®€å•ä¿¡æ¯
â”‚ â€¢ 6 å°æ—¶åé‡ç½®               â”‚  â† æ˜ç¡®æ—¶é—´
â”‚                             â”‚
â”‚ [ä½¿ç”¨è‡ªå·±çš„ API Key]         â”‚  â† æ˜æ˜¾çš„ CTA
â”‚                             â”‚
â”‚ ğŸ’¡ æ·»åŠ åæ— éœ€æ¶ˆè€—å…è´¹é¢åº¦     â”‚  â† æ¸…æ™°çš„ä»·å€¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
- âœ… å¤§æ•°å­— - æœ€é‡è¦çš„ä¿¡æ¯æœ€æ˜¾çœ¼
- âœ… è¿›åº¦æ¡ - è§†è§‰åŒ–å‰©ä½™æ¯”ä¾‹
- âœ… ç®€å•ä¿¡æ¯ - åªæ˜¾ç¤ºå¿…è¦çš„
- âœ… æ˜ç¡® CTA - æ¸…æ¥šçŸ¥é“ä¸‹ä¸€æ­¥
- âœ… ä»·å€¼è¯´æ˜ - è§£é‡Šä¸ºä»€ä¹ˆè¦æ·»åŠ  API Key

---

## Implementation

### æ ¸å¿ƒä»£ç ï¼ˆ~200 è¡Œï¼‰

```typescript
export class SimpleQuotaBar {
  private statusBar: vscode.StatusBarItem;
  private quota: number = 50;
  private used: number = 0;

  // æ›´æ–°æ˜¾ç¤ºï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
  private update(): void {
    const remaining = this.quota - this.used;
    const percentage = remaining / this.quota;

    // é€‰æ‹©å›¾æ ‡å’Œé¢œè‰²
    let icon: string;
    let color: string | undefined;

    if (percentage > 0.3) {
      icon = 'âš¡';
      color = undefined;
    } else if (percentage > 0.1) {
      icon = 'âš ï¸';
      color = 'statusBarItem.warningBackground';
    } else {
      icon = 'ğŸ”´';
      color = 'statusBarItem.errorBackground';
    }

    this.statusBar.text = `${icon} ${remaining}/${this.quota}`;
    this.statusBar.tooltip = `ä»Šæ—¥å‰©ä½™é¢åº¦ï¼š${remaining}/${this.quota}`;
    this.statusBar.backgroundColor = color;
  }

  // æ¶ˆè€—é¢åº¦ï¼ˆå¸¦åé¦ˆï¼‰
  async consume(amount: number = 1): Promise<boolean> {
    if (this.used + amount > this.quota) {
      const action = await vscode.window.showWarningMessage(
        `é¢åº¦ä¸è¶³ï¼ä»Šæ—¥å‰©ä½™ ${this.quota - this.used}/${this.quota}`,
        'ä½¿ç”¨è‡ªå·±çš„ API Key',
        'æ˜å¤©å†è¯•'
      );

      if (action === 'ä½¿ç”¨è‡ªå·±çš„ API Key') {
        await vscode.commands.executeCommand('miaoda.addApiKey');
      }

      return false;
    }

    this.used += amount;
    this.update();
    return true;
  }
}
```

---

## User Experience

### åœºæ™¯ 1: æ­£å¸¸ä½¿ç”¨

```
ç”¨æˆ·æ‰“å¼€ VSCode
  â†“
çœ‹åˆ°çŠ¶æ€æ : âš¡ 45/50
  â†“
å¿ƒç†: "è¿˜æœ‰å¾ˆå¤šé¢åº¦ï¼Œæ”¾å¿ƒç”¨"
  â†“
ä½¿ç”¨åŠŸèƒ½
  â†“
çŠ¶æ€æ æ›´æ–°: âš¡ 44/50
  â†“
ç»§ç»­ä½¿ç”¨
```

### åœºæ™¯ 2: é¢åº¦ä¸è¶³

```
çŠ¶æ€æ å˜çº¢: ğŸ”´ 2/50
  â†“
ç”¨æˆ·æ³¨æ„åˆ°
  â†“
ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
  â†“
çœ‹åˆ°: "6 å°æ—¶åé‡ç½®" + "ä½¿ç”¨è‡ªå·±çš„ API Key"
  â†“
å†³ç­–:
  - ç­‰å¾…é‡ç½®ï¼ˆæ˜ç¡®çŸ¥é“æ—¶é—´ï¼‰
  - æ·»åŠ  API Keyï¼ˆæ˜ç¡®çŸ¥é“å¥½å¤„ï¼‰
```

### åœºæ™¯ 3: æ·»åŠ  API Key

```
ç‚¹å‡» "ä½¿ç”¨è‡ªå·±çš„ API Key"
  â†“
è¾“å…¥ API Key
  â†“
çŠ¶æ€æ å˜ä¸º: âˆ API Key
  â†“
å¿ƒç†: "æ— é™ä½¿ç”¨ï¼Œå®‰å¿ƒäº†"
```

---

## Design Principles

### 1. ç®€æ´èƒœäºå¤æ‚

âŒ **ä¸åš**:
- å¤æ‚çš„å›¾è¡¨
- å¤šä½™çš„ç»Ÿè®¡
- èŠ±å“¨çš„åŠ¨ç”»
- è¿‡å¤šçš„é…ç½®

âœ… **åªåš**:
- å‰©ä½™é¢åº¦ï¼ˆæ ¸å¿ƒä¿¡æ¯ï¼‰
- é‡ç½®æ—¶é—´ï¼ˆæ˜ç¡®é¢„æœŸï¼‰
- æ·»åŠ  API Keyï¼ˆæ˜ç¡®å‡ºè·¯ï¼‰

### 2. æ˜ç¡®èƒœäºæ¨¡ç³Š

âŒ **æ¨¡ç³Š**: "é¢åº¦å³å°†ç”¨å®Œ"
âœ… **æ˜ç¡®**: "å‰©ä½™ 2/50ï¼Œ6 å°æ—¶åé‡ç½®"

âŒ **æ¨¡ç³Š**: "è·å–æ›´å¤šé¢åº¦"
âœ… **æ˜ç¡®**: "ä½¿ç”¨è‡ªå·±çš„ API Keyï¼ˆæ— é™é¢åº¦ï¼‰"

### 3. è§†è§‰èƒœäºæ–‡å­—

âŒ **æ–‡å­—**: "æ‚¨çš„é¢åº¦ä½¿ç”¨ç‡ä¸º 90%"
âœ… **è§†è§‰**: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 45/50

### 4. ä¸»åŠ¨èƒœäºè¢«åŠ¨

âŒ **è¢«åŠ¨**: ç”¨æˆ·ç”¨å®Œæ‰çŸ¥é“
âœ… **ä¸»åŠ¨**: ä½äº 30% å˜æ©™è‰²æé†’

---

## Success Metrics

### ç›®æ ‡

1. **ç†è§£åº¦**: 95% ç”¨æˆ·ä¸€çœ¼çœ‹æ‡‚å‰©ä½™é¢åº¦
2. **è½¬åŒ–ç‡**: 30% é¢åº¦ä¸è¶³ç”¨æˆ·æ·»åŠ  API Key
3. **æ»¡æ„åº¦**: NPS > 8/10
4. **æ”¯æŒé‡**: é¢åº¦ç›¸å…³é—®é¢˜ < 5%

### æµ‹è¯•æ–¹æ³•

```markdown
## ç”¨æˆ·æµ‹è¯•

é—®é¢˜ 1: "è¿™ä¸ªå›¾æ ‡æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" âš¡ 45/50
æœŸæœ›: "å‰©ä½™ 45 æ¬¡ï¼Œæ€»å…± 50 æ¬¡"

é—®é¢˜ 2: "é¢åº¦ç”¨å®Œäº†æ€ä¹ˆåŠï¼Ÿ"
æœŸæœ›: "ç­‰æ˜å¤©é‡ç½®ï¼Œæˆ–è€…æ·»åŠ è‡ªå·±çš„ API Key"

é—®é¢˜ 3: "æ·»åŠ  API Key æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"
æœŸæœ›: "æ— é™ä½¿ç”¨ï¼Œä¸æ¶ˆè€—å…è´¹é¢åº¦"
```

---

## Comparison

### Miaoda vs å…¶ä»–å·¥å…·

| ç‰¹æ€§ | Cursor | Copilot | Miaoda |
|------|--------|---------|--------|
| é¢åº¦æ˜¾ç¤º | âŒ | âŒ | âœ… çŠ¶æ€æ  |
| å‰©ä½™å¯è§ | âŒ | âŒ | âœ… ä¸€çœ¼çœ‹åˆ° |
| é‡ç½®æ—¶é—´ | âŒ | âŒ | âœ… æ˜ç¡®æ˜¾ç¤º |
| è‡ªå®šä¹‰ Key | âœ… | âŒ | âœ… ä¸€é”®æ·»åŠ  |
| å­¦ä¹ æˆæœ¬ | ä¸­ | ä½ | é›¶ |

---

## Implementation Plan

### Week 1: Core
- [x] SimpleQuotaBar å®ç°
- [x] çŠ¶æ€æ æ˜¾ç¤º
- [x] è¯¦æƒ…é¢æ¿
- [x] é¢åº¦æ¶ˆè€—é€»è¾‘

### Week 2: Polish
- [ ] åŠ¨ç”»ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†
- [ ] è¾¹ç•Œæƒ…å†µ
- [ ] ç”¨æˆ·æµ‹è¯•

### Week 3: Integration
- [ ] é›†æˆåˆ°ä¸»æ‰©å±•
- [ ] è¿æ¥ AI è°ƒç”¨
- [ ] æ·»åŠ  API Key æµç¨‹
- [ ] æ–‡æ¡£æ›´æ–°

---

## Key Takeaways

1. **ç®€æ´ > å¤æ‚** - åªæ˜¾ç¤ºå¿…è¦ä¿¡æ¯
2. **æ˜ç¡® > æ¨¡ç³Š** - æ¸…æ¥šå‘Šè¯‰ç”¨æˆ·ä¸‹ä¸€æ­¥
3. **è§†è§‰ > æ–‡å­—** - ç”¨å›¾æ ‡å’Œé¢œè‰²ä¼ è¾¾ä¿¡æ¯
4. **ä¸»åŠ¨ > è¢«åŠ¨** - æå‰æé†’ï¼Œä¸è®©ç”¨æˆ·æªæ‰‹ä¸åŠ

---

**çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆï¼Œä»£ç å®ç°å®Œæˆ

**æ–‡ä»¶**: `SimpleQuotaBar.ts` (~200 è¡Œ)

**ä¸‹ä¸€æ­¥**: é›†æˆåˆ°ä¸»æ‰©å±•å¹¶æµ‹è¯•

**æ—¥æœŸ**: 2026-02-22
